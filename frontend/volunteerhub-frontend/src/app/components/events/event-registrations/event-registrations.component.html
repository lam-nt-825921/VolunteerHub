<div class="event-registrations">
  <div class="registrations-header">
    <h3>Danh sách đăng ký</h3>
    @if (canManage) {
      <button class="btn btn-secondary" (click)="exportToCSV()">
        <mat-icon>download</mat-icon>
        Export CSV
      </button>
    }
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <mat-icon>refresh</mat-icon>
      <p>Đang tải...</p>
    </div>
  }

  <!-- Pending Registrations -->
  @if (pendingRegistrations.length > 0 && canManage) {
    <div class="registration-section">
      <h4>Chờ duyệt ({{ pendingRegistrations.length }})</h4>
      <div class="registrations-list">
        @for (reg of pendingRegistrations; track reg.id) {
          <div class="registration-card">
            <div class="registration-info">
              <p><strong>{{ reg.user?.fullName || 'Unknown' }}</strong></p>
              <p class="registration-date">Đăng ký: {{ formatDate(reg.registeredAt) }}</p>
            </div>
            <div class="registration-actions">
              <button class="btn btn-success" (click)="approveRegistration(reg.id)">
                <mat-icon>check</mat-icon>
                Duyệt
              </button>
              <button class="btn btn-danger" (click)="rejectRegistration(reg.id)">
                <mat-icon>close</mat-icon>
                Từ chối
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Approved Registrations -->
  @if (approvedRegistrations.length > 0) {
    <div class="registration-section">
      <h4>Đã duyệt ({{ approvedRegistrations.length }})</h4>
      <div class="registrations-list">
        @for (reg of approvedRegistrations; track reg.id) {
          <div class="registration-card">
            <div class="registration-info">
              <p><strong>{{ reg.user?.fullName || 'Unknown' }}</strong></p>
              <p class="registration-date">Đăng ký: {{ formatDate(reg.registeredAt) }}</p>
            </div>
            @if (canManage && reg.status === 'APPROVED') {
              <div class="registration-actions">
                <button class="btn btn-primary" (click)="checkIn(reg.id)">
                  <mat-icon>check_circle</mat-icon>
                  Điểm danh
                </button>
                <button class="btn btn-danger" (click)="kickParticipant(reg.id)">
                  <mat-icon>person_remove</mat-icon>
                  Xóa
                </button>
              </div>
            }
          </div>
        }
      </div>
    </div>
  }

  <!-- Attended Registrations -->
  @if (attendedRegistrations.length > 0) {
    <div class="registration-section">
      <h4>Đã điểm danh ({{ attendedRegistrations.length }})</h4>
      <div class="registrations-list">
        @for (reg of attendedRegistrations; track reg.id) {
          <div class="registration-card">
            <div class="registration-info">
              <p><strong>{{ reg.user?.fullName || 'Unknown' }}</strong></p>
              <p class="registration-date">Đăng ký: {{ formatDate(reg.registeredAt) }}</p>
              @if (reg.attendedAt) {
                <p class="registration-date">Điểm danh: {{ formatDate(reg.attendedAt) }}</p>
              }
            </div>
            <div class="registration-badge attended">
              <mat-icon>verified</mat-icon>
              Đã tham gia
            </div>
          </div>
        }
      </div>
    </div>
  }

  @if (registrations.length === 0 && !isLoading()) {
    <div class="empty-state">
      <mat-icon>people_outline</mat-icon>
      <p>Chưa có đăng ký nào</p>
    </div>
  }
</div>
